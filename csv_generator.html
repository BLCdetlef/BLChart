<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRUCHLAST Excel Template Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            background-color: #e0e0e0;
            border: none;
            cursor: pointer;
            margin-right: 5px;
        }
        
        .tab.active {
            background-color: #007bff;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        input {
            width: 100%;
            padding: 5px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }
        
        .validation-ok {
            background-color: #d4edda;
            color: #155724;
        }
        
        .validation-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .metadata-section {
            margin-bottom: 20px;
        }
        
        .metadata-section h3 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        
        .formula-display {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
        }
        
        .export-section {
            background-color: #e7f3ff;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        
        button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>BRUCHLAST Excel Template Simulator</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('messwerte')">Messwerte</button>
            <button class="tab" onclick="showTab('metadaten')">Metadaten</button>
            <button class="tab" onclick="showTab('anleitung')">Anleitung</button>
        </div>
        
        <!-- Tabellenblatt 1: Messwerte -->
        <div id="messwerte" class="tab-content active">
            <h2>Messwerte und Berechnungen</h2>
            
            <div class="metadata-section">
                <h3>Kurveninformationen</h3>
                <table>
                    <tr>
                        <th>Kurvenname</th>
                        <th>Kurventyp</th>
                        <th>Linienfarbe</th>
                    </tr>
                    <tr>
                        <td><input type="text" id="kurvenname" placeholder="z.B. U_rot_Testkurve" maxlength="30"></td>
                        <td>
                            <select id="kurventyp">
                                <option value="U">U = Ursache (gestrichelt)</option>
                                <option value="W">W = Wirkung (durchgezogen)</option>
                            </select>
                        </td>
                        <td>
                            <select id="linienfarbe">
                                <option value="rot">rot</option>
                                <option value="gelb">gelb</option>
                                <option value="blau">blau</option>
                                <option value="grün">grün</option>
                                <option value="orange">orange</option>
                                <option value="lila">lila</option>
                            </select>
                        </td>
                    </tr>
                </table>
            </div>
            
            <div class="metadata-section">
                <h3>Grenzwerte</h3>
                <table>
                    <tr>
                        <th>Unterer Grenzwert</th>
                        <th>Oberer Grenzwert</th>
                    </tr>
                    <tr>
                        <td><input type="number" id="untererGrenzwert" step="0.01"></td>
                        <td><input type="number" id="obererGrenzwert" step="0.01"></td>
                    </tr>
                </table>
            </div>
            
            <div class="metadata-section">
                <h3>Messwerte (mindestens 5, maximal 30 Datensätze)</h3>
                <div style="margin-bottom: 10px;">
                    <button onclick="addDataRow()" style="background-color: #28a745; margin-right: 10px;">+ Datensatz hinzufügen</button>
                    <button onclick="removeDataRow()" style="background-color: #dc3545;">- Datensatz entfernen</button>
                </div>
                <table id="messwerteTable">
                    <thead>
                        <tr>
                            <th>Jahr (1700-2100)</th>
                            <th>Messwert</th>
                            <th>Prozent (automatisch)</th>
                            <th>Validierung</th>
                        </tr>
                    </thead>
                    <tbody id="messwerteBody">
                        <!-- Wird durch JavaScript gefüllt -->
                    </tbody>
                </table>
            </div>
            
            <div class="formula-display">
                <strong>Formel:</strong> Prozent = ((Messwert - Unterer_Grenzwert) / (Oberer_Grenzwert - Unterer_Grenzwert)) * 100
            </div>
        </div>
        
        <!-- Tabellenblatt 2: Metadaten -->
        <div id="metadaten" class="tab-content">
            <h2>Metadaten und Quellenangaben</h2>
            
            <div class="metadata-section">
                <h3>Kurvenbeschreibung</h3>
                <textarea id="kurvenbeschreibung" rows="4" style="width: 100%; padding: 10px;" 
                    placeholder="Detaillierte Beschreibung der Kurve und Messwerte..."></textarea>
            </div>
            
            <div class="metadata-section">
                <h3>Quellenangaben</h3>
                <table>
                    <tr>
                        <th>Autoren</th>
                        <td><input type="text" id="autoren" placeholder="Namen der Autoren"></td>
                    </tr>
                    <tr>
                        <th>Veröffentlichungsdatum</th>
                        <td><input type="date" id="veroeffentlichungsdatum"></td>
                    </tr>
                    <tr>
                        <th>Veröffentlichungsort</th>
                        <td><input type="text" id="veroeffentlichungsort" placeholder="Zeitschrift, Konferenz, etc."></td>
                    </tr>
                    <tr>
                        <th>Internetlink</th>
                        <td><input type="url" id="internetlink" placeholder="DOI, URL zum Paper"></td>
                    </tr>
                    <tr>
                        <th>Zusätzliche Informationen</th>
                        <td><textarea id="zusatzinfo" rows="3" style="width: 100%; padding: 5px;" 
                            placeholder="Weitere relevante Details..."></textarea></td>
                    </tr>
                </table>
            </div>
        </div>
        
        <!-- Tabellenblatt 3: Anleitung -->
        <div id="anleitung" class="tab-content">
            <h2>Anleitung und Regeln</h2>
            
            <div class="metadata-section">
                <h3>Dateinamen-Konvention</h3>
                <ul>
                    <li><strong>Format:</strong> [U/W]_[Farbe]_[Beschreibung].xlsx</li>
                    <li><strong>Maximale Länge:</strong> 30 Zeichen</li>
                    <li><strong>Beispiele:</strong>
                        <ul>
                            <li>U_rot_Testkurve.xlsx (Ursache, rot, gestrichelt)</li>
                            <li>W_gelb_Beispielkurve.xlsx (Wirkung, gelb, durchgezogen)</li>
                            <li>U_blau_Temperatur.xlsx (Ursache, blau, gestrichelt)</li>
                        </ul>
                    </li>
                </ul>
            </div>
            
            <div class="metadata-section">
                <h3>Validierungsregeln</h3>
                <ol>
                    <li><strong>Jahresangabe:</strong> Zwischen 1700 und 2100</li>
                    <li><strong>Mindestanzahl:</strong> Mindestens 5 Messwerte erforderlich</li>
                    <li><strong>Abstand:</strong> Zwischen Messwerten mindestens 10 Jahre</li>
                    <li><strong>Grenzwerte:</strong> Müssen definiert werden</li>
                </ol>
            </div>
            
            <div class="metadata-section">
                <h3>Formel</h3>
                <div class="formula-display">
                    Prozent = ((Messwert - Unterer_Grenzwert) / (Oberer_Grenzwert - Unterer_Grenzwert)) * 100
                </div>
            </div>
        </div>
        
        <div class="export-section">
            <h3>CSV-Export</h3>
            <button onclick="exportCSV()">Als CSV exportieren</button>
            <button onclick="validateData()">Daten validieren</button>
            <div id="validationResult"></div>
        </div>
    </div>

    <script>
        // Initialisierung
        let dataRows = [];
        let nextRowId = 1;
        
        // Tabellenblatt anzeigen
        function showTab(tabName) {
            // Alle Tabs ausblenden
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Gewählten Tab anzeigen
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // Datensatz hinzufügen
        function addDataRow() {
            if (dataRows.length >= 30) {
                alert('Maximal 30 Datensätze erlaubt!');
                return;
            }
            
            const tbody = document.getElementById('messwerteBody');
            const row = tbody.insertRow();
            const rowId = nextRowId++;
            
            row.innerHTML = `
                <td><input type="number" min="1700" max="2100" value="1700" class="year-input" onchange="validateYear(this, ${rowId})"></td>
                <td><input type="number" step="0.01" class="messwert-input" onchange="calculatePercentage(this, ${rowId})"></td>
                <td class="prozent-cell"></td>
                <td class="validation-cell"></td>
            `;
            
            dataRows.push({ id: rowId, row: row });
            validateAllData();
        }
        
        // Datensatz entfernen
        function removeDataRow() {
            if (dataRows.length <= 5) {
                alert('Mindestens 5 Datensätze erforderlich!');
                return;
            }
            
            const tbody = document.getElementById('messwerteBody');
            if (tbody.rows.length > 0) {
                tbody.deleteRow(tbody.rows.length - 1);
                dataRows.pop();
            }
            validateAllData();
        }
        
        // Jahr validieren
        function validateYear(input, rowId) {
            const year = parseInt(input.value);
            const row = input.closest('tr');
            const validationCell = row.querySelector('.validation-cell');
            
            if (year < 1700 || year > 2100) {
                validationCell.textContent = 'Jahr außerhalb 1700-2100';
                validationCell.className = 'validation-cell validation-error';
                return false;
            }
            
            // Mindestens 10 Jahre Abstand zu anderen Jahren prüfen
            const allYears = [];
            document.querySelectorAll('.year-input').forEach(yInput => {
                if (yInput !== input && yInput.value) {
                    allYears.push(parseInt(yInput.value));
                }
            });
            
            for (let otherYear of allYears) {
                if (Math.abs(year - otherYear) < 10) {
                    validationCell.textContent = 'Mindestens 10 Jahre Abstand erforderlich';
                    validationCell.className = 'validation-cell validation-error';
                    return false;
                }
            }
            
            validationCell.textContent = 'OK';
            validationCell.className = 'validation-cell validation-ok';
            return true;
        }
        
        // Prozentwert berechnen
        function calculatePercentage(input, rowId) {
            const messwert = parseFloat(input.value);
            const untererGrenzwert = parseFloat(document.getElementById('untererGrenzwert').value);
            const obererGrenzwert = parseFloat(document.getElementById('obererGrenzwert').value);
            
            const row = input.closest('tr');
            const prozentCell = row.querySelector('.prozent-cell');
            
            if (messwert && untererGrenzwert && obererGrenzwert && obererGrenzwert !== untererGrenzwert) {
                const prozent = ((messwert - untererGrenzwert) / (obererGrenzwert - untererGrenzwert)) * 100;
                prozentCell.textContent = prozent.toFixed(2) + '%';
            } else {
                prozentCell.textContent = '';
            }
            
            validateAllData();
        }
        
        // Alle Daten validieren
        function validateAllData() {
            const messwertInputs = document.querySelectorAll('.messwert-input');
            let messwerteCount = 0;
            let errors = [];
            
            messwertInputs.forEach(input => {
                if (input.value && parseFloat(input.value) !== 0) {
                    messwerteCount++;
                }
            });
            
            if (messwerteCount < 5) {
                errors.push('Mindestens 5 Messwerte erforderlich');
            }
            
            if (messwerteCount > 30) {
                errors.push('Maximal 30 Messwerte erlaubt');
            }
            
            if (!document.getElementById('untererGrenzwert').value || !document.getElementById('obererGrenzwert').value) {
                errors.push('Grenzwerte müssen definiert werden');
            }
            
            if (!document.getElementById('kurvenname').value) {
                errors.push('Kurvenname muss angegeben werden');
            }
            
            const resultDiv = document.getElementById('validationResult');
            if (errors.length === 0) {
                resultDiv.innerHTML = '<div class="validation-ok">✅ Alle Validierungen erfolgreich!</div>';
            } else {
                resultDiv.innerHTML = '<div class="validation-error">❌ Fehler: ' + errors.join(', ') + '</div>';
            }
        }
        
        // Daten validieren (Button)
        function validateData() {
            validateAllData();
        }
        
        // CSV exportieren
        function exportCSV() {
            const kurvenname = document.getElementById('kurvenname').value;
            const kurventyp = document.getElementById('kurventyp').value;
            const linienfarbe = document.getElementById('linienfarbe').value;
            const kurvenbeschreibung = document.getElementById('kurvenbeschreibung').value;
            const autoren = document.getElementById('autoren').value;
            const veroeffentlichungsdatum = document.getElementById('veroeffentlichungsdatum').value;
            const veroeffentlichungsort = document.getElementById('veroeffentlichungsort').value;
            const internetlink = document.getElementById('internetlink').value;
            const zusatzinfo = document.getElementById('zusatzinfo').value;
            const untererGrenzwert = document.getElementById('untererGrenzwert').value;
            const obererGrenzwert = document.getElementById('obererGrenzwert').value;
            
            let csv = `# Kurvenname: ${kurvenname}\n`;
            csv += `# Kurventyp: ${kurventyp === 'U' ? 'Ursache (gestrichelte Linie)' : 'Wirkung (durchgezogene Linie)'}\n`;
            csv += `# Linienfarbe: ${linienfarbe}\n`;
            csv += `# Kurvenbeschreibung: ${kurvenbeschreibung}\n`;
            csv += `# Autoren: ${autoren}\n`;
            csv += `# Veröffentlichungsdatum: ${veroeffentlichungsdatum}\n`;
            csv += `# Veröffentlichungsort: ${veroeffentlichungsort}\n`;
            csv += `# Internetlink: ${internetlink}\n`;
            csv += `# Zusätzliche Informationen: ${zusatzinfo}\n`;
            csv += `# Grenzwerte für diese Kurve\n`;
            csv += `# Unterer_Grenzwert: ${untererGrenzwert}\n`;
            csv += `# Oberer_Grenzwert: ${obererGrenzwert}\n`;
            csv += `# Formel: Prozent = ((Messwert - ${untererGrenzwert}) / (${obererGrenzwert} - ${untererGrenzwert})) * 100\n\n`;
            csv += `Jahr,Messwert,Prozent\n`;
            
            // Alle Datensätze sammeln und sortieren
            const dataPoints = [];
            const yearInputs = document.querySelectorAll('.year-input');
            const messwertInputs = document.querySelectorAll('.messwert-input');
            
            for (let i = 0; i < yearInputs.length; i++) {
                const year = parseInt(yearInputs[i].value);
                const messwert = parseFloat(messwertInputs[i].value);
                
                if (year && messwert && !isNaN(year) && !isNaN(messwert)) {
                    const prozentCell = yearInputs[i].closest('tr').querySelector('.prozent-cell');
                    const prozent = prozentCell.textContent.replace('%', '');
                    
                    if (prozent && prozent !== '') {
                        dataPoints.push({
                            year: year,
                            messwert: messwert,
                            prozent: parseFloat(prozent)
                        });
                    }
                }
            }
            
            // Nach Jahr sortieren
            dataPoints.sort((a, b) => a.year - b.year);
            
            // CSV-Daten ausgeben
            dataPoints.forEach(point => {
                csv += `${point.year},${point.messwert},${point.prozent.toFixed(2)}\n`;
            });
            
            // CSV-Datei herunterladen
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${kurvenname}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }
        
        // Initialisierung beim Laden
        window.onload = function() {
            // 5 Standard-Datensätze erstellen
            for (let i = 0; i < 5; i++) {
                addDataRow();
            }
        };
    </script>
</body>
</html> 